#!/usr/bin/python

import mysql.connector

# Open database connection (If database is not created, don't give dbname)
cnx = mysql.connector.connect(host='localhost', user='root', password='root')

# prepare a cursor object using cursor() method
cursor = cnx.cursor()

cursor.execute("DROP DATABASE IF EXISTS user_db")

try:
    cursor.execute("CREATE DATABASE user_db DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci")
except mysql.connector.Error as err:
    print('Error:', err)

cursor.execute("USE user_db")
cursor.execute("DROP TABLE IF EXISTS users")

cursor.execute("CREATE TABLE users ( \
id SMALLINT(3) NOT NULL AUTO_INCREMENT, \
username VARCHAR(40) NOT NULL, \
PRIMARY KEY(id) \
)ENGINE=innoDB DEFAULT CHARACTER SET=utf8 COLLATE=utf8_unicode_ci")

cursor.execute("CREATE TABLE reading_history ( \
article_id SMALLINT(3) NOT NULL AUTO_INCREMENT, \
article_title VARCHAR(80) NOT NULL, \
user_name VARCHAR(40) NOT NULL,
PRIMARY KEY(article_id) \
)ENGINE=innoDB DEFAULT CHARACTER SET=utf8 COLLATE=utf8_unicode_ci")

cursor.execute("LOAD DATA LOCAL INFILE '/home/afro/PycharmProjects/create_db/users.txt' "
               "INTO TABLE users FIELDS TERMINATED BY ',' LINES TERMINATED BY '\n' (@col1) set username=@col1")

cnx.commit()
cursor.close()
cnx.close()
